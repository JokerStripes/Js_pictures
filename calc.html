<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Educational PK Quick Calculator</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: Arial, Helvetica, sans-serif; margin:18px; background:#f7fbff; color:#111; }
    .card { background:#fff; padding:14px; border-radius:8px; box-shadow:0 2px 8px rgba(20,40,60,0.06); margin-bottom:14px; }
    label { display:block; margin-bottom:6px; font-weight:600; }
    input[type="number"] { padding:8px; width:120px; border-radius:6px; border:1px solid #d6e3ff; }
    button { margin-left:8px; padding:8px 12px; background:#2b7cff; color:white; border:none; border-radius:6px; cursor:pointer; }
    #results { margin-top:10px; }
    canvas { width:100%; height:320px; }
    small.note { color:#555; display:block; margin-top:6px; }
  </style>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <h2>PK Quick — Educational</h2>

  <div class="card">
    <strong>Instructions (educational):</strong>
    <p>Enter the <em>amount taken</em> (grams). The page plots parent and metabolite concentrations (μg/L) and shows peak times and peak concentrations. <strong>No detection-limit or time-to-undetectable calculations are provided.</strong></p>
  </div>

  <div class="card">
    <label for="dose">Amount taken (grams)</label>
    <input id="dose" type="number" min="0" step="0.01" value="1.00">
    <button id="goBtn">Compute</button>

    <div id="results" style="margin-top:12px;">
      <div id="peakParent"></div>
      <div id="peakMet"></div>
      <small class="note">Fixed model: parent t½ = 1.5 h; metabolite fraction = 0.40; metabolite t½ = 12 h; volume = 5 L.</small>
    </div>
  </div>

  <div class="card">
    <canvas id="chart"></canvas>
  </div>

<script>
(function(){
  // fixed parameters (educational)
  const t12_parent = 1.5;   // hours
  const t12_met = 12.0;     // hours
  const frac = 0.40;        // fraction converted to metabolite
  const vol_L = 5.0;        // distribution volume (L)
  const t_max = 200;        // hours to simulate
  const n_points = 400;

  function ln2(){ return Math.log(2); }
  function kp() { return ln2()/t12_parent; }
  function km() { return ln2()/t12_met; }

  function compute(dose_g){
    const A0 = dose_g * 1e6; // ug
    const kpv = kp();
    const kmv = km();
    const times = [];
    const parent = [];
    const met = [];

    for (let i=0;i<=n_points;i++){
      const t = (i/n_points)*t_max;
      times.push(t);
      const Ap = A0 * Math.exp(-kpv * t);
      const Cp = Ap / vol_L;
      let M = 0;
      if (Math.abs(kmv - kpv) > 1e-12) {
        M = frac * A0 * (kpv/(kmv - kpv)) * (Math.exp(-kpv * t) - Math.exp(-kmv * t));
      } else {
        // fallback (rare)
        M = frac * A0 * kpv * t * Math.exp(-kpv * t);
      }
      const Cm = M / vol_L;
      parent.push(Cp);
      met.push(Cm);
    }

    // find peaks
    let peakP = {val: -1, t: 0};
    let peakM = {val: -1, t: 0};
    for (let i=0;i<times.length;i++){
      if (parent[i] > peakP.val){ peakP.val = parent[i]; peakP.t = times[i]; }
      if (met[i] > peakM.val){ peakM.val = met[i]; peakM.t = times[i]; }
    }

    return { times, parent, met, peakP, peakM };
  }

  // Setup chart
  const ctx = document.getElementById('chart').getContext('2d');
  const chart = new Chart(ctx, {
    type: 'line',
    data: { labels: [], datasets: [
      { label: 'Parent (μg/L)', data: [], borderColor:'#2b7cff', fill:false, tension:0.12, pointRadius:0 },
      { label: 'Metabolite (μg/L)', data: [], borderColor:'#d44', fill:false, tension:0.12, borderDash:[6,4], pointRadius:0 }
    ]},
    options: {
      responsive:true,
      maintainAspectRatio:false,
      scales: {
        x: { title: { display:true, text:'Time (h)'} },
        y: { title: { display:true, text:'Concentration (μg/L)'}, beginAtZero:true, type:'linear' }
      },
      plugins: {
        tooltip: {
          callbacks: {
            label: function(ctx) {
              return ctx.dataset.label + ': ' + Number(ctx.parsed.y).toExponential(3) + ' μg/L';
            }
          }
        },
        legend: { position:'top' }
      }
    }
  });

  function render(dose){
    const data = compute(dose);
    chart.data.labels = data.times.map(t => t.toFixed(1));
    chart.data.datasets[0].data = data.parent;
    chart.data.datasets[1].data = data.met;
    chart.update();

    document.getElementById('peakParent').innerHTML =
      `<strong>Parent peak:</strong> ${data.peakP.val.toFixed(0)} μg/L at ${data.peakP.t.toFixed(2)} h`;

    document.getElementById('peakMet').innerHTML =
      `<strong>Metabolite peak:</strong> ${data.peakM.val.toFixed(0)} μg/L at ${data.peakM.t.toFixed(2)} h`;
  }

  // initial
  render(parseFloat(document.getElementById('dose').value) || 1.0);

  document.getElementById('goBtn').addEventListener('click', function(){
    const v = parseFloat(document.getElementById('dose').value);
    if (!isFinite(v) || v < 0) { alert('Enter a valid non-negative amount in grams.'); return; }
    render(v);
  });

})();
</script>
</body>
</html>